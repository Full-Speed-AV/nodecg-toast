<link rel="import" href="../components/polymer/polymer.html">

<dom-module id="nodecg-toast">
    <template>
        <content id="content"></content>
    </template>

    <script>
        Polymer({
            is: 'nodecg-toast',

            properties: {
                /**
                 * The duration in milliseconds to show the toast.
                 */
                duration: {
                    type: Number,
                    value: 3000,
                    observer: '_durationChanged'
                },

                /**
                 * The text to display in the toast.
                 */
                text: {
                    type: String,
                    value: '',
                    observer: '_textChanged'
                }
            },

            // Set up content observer and toaster.
            ready: function() {
                var topDoc = window.top.document;

                if (typeof topDoc.PaperToast === 'undefined') {
                    throw new Error('The "paper-toast" element does not appear to be loaded on the dashboard.' +
                            ' Aborting.');
                }

                this.toaster = topDoc.createElement('paper-toast');
                this.toaster.duration = this.duration;
                this.toaster.text = this.text;
                topDoc.body.appendChild(this.toaster);

                var observer = new MutationObserver(this._contentChanged.bind(this));
                observer.observe(this.$.content, {childList: true, subtree: true, characterData: true});
            },

            /**
             * Show the toast.
             * @method show
             */
            show: function() {
                this.toaster.show();
            },

            /**
             * Hide the toast
             */
            hide: function() {
                this.toaster.hide();
            },

            _durationChanged: function() {
                if (!this.toaster) return;
                this.toaster.duration = this.duration;
            },

            _textChanged: function() {
                if (!this.toaster) return;
                this.toaster.text = this.text;
            },

            _contentChanged: function() {
                var self = this;

                // Remove any existing content from the toaster.
                while (this.toaster.firstChild) {
                    this.toaster.removeChild(this.toaster.firstChild);
                }

                // Clone the current content in the toaster.
                var distributedNodes = Polymer.dom(this.$.content).getDistributedNodes();
                distributedNodes.forEach(function(node) {
                    Polymer.dom(self.toster).appendChild(node.cloneNode(true));
                });
            }
        })
    </script>
</dom-module>