<link rel="import" href="../polymer/polymer.html">

<!--
`nodecg-toast` is a remote wrapper to a [`paper-toast`](https://elements.polymer-project.org/elements/paper-toast) element present on the Dashboard.
Each `nodecg-toast` element creates its own `paper-toast`.

Because every NodeCG panel is an iframe, we cannot attach a `paper-toast` element directly to the panel. Instead,
we must traverse up past the iframe boundary and attach it directly to the dashboard's `body` tag. `nodecg-toast`
takes care of this for you and makes it transparent.
-->

<dom-module id="nodecg-toast">
    <style>
        :host {
            display: none;
        }
    </style>

    <template>
        <content id="content"></content>
    </template>

    <script>
        Polymer({
            is: 'nodecg-toast',

            properties: {
                /**
                 * The duration in milliseconds to show the toast.
                 */
                duration: {
                    type: Number,
                    value: 3000,
                    observer: '_durationChanged'
                },

                /**
                 * The text to display in the toast.
                 */
                text: {
                    type: String,
                    value: '',
                    observer: '_textChanged'
                }
            },

            // Set up content observer and toaster.
            ready: function() {
                var topDoc = window.top.document;
                this.toaster = topDoc.createElement('paper-toast');
                this.toaster.duration = this.duration;
                this.toaster.text = this.text;
                topDoc.body.appendChild(this.toaster);

                var observer = new MutationObserver(this._contentChanged.bind(this));
                observer.observe(this.$.content, {childList: true, subtree: true, characterData: true});
            },

            /**
             * Show the toast.
             * @method show
             */
            show: function() {
                this.toaster.show();
            },

            /**
             * Hide the toast
             */
            hide: function() {
                this.toaster.hide();
            },

            _durationChanged: function() {
                if (!this.toaster) return;
                this.toaster.duration = this.duration;
            },

            _textChanged: function() {
                if (!this.toaster) return;
                this.toaster.text = this.text;
            },

            _contentChanged: function() {
                var self = this;

                // Remove any existing content from the toaster.
                while (this.toaster.firstChild) {
                    this.toaster.removeChild(this.toaster.firstChild);
                }

                // Clone the current content in the toaster.
                var distributedNodes = Polymer.dom(this.$.content).getDistributedNodes();
                distributedNodes.forEach(function(node) {
                    Polymer.dom(self.toster).appendChild(node.cloneNode(true));
                });
            }
        })
    </script>
</dom-module>